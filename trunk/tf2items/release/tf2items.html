<!doctype html>

<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" type="text/css" href="tf2items.css" />

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/querystring.js"></script>

    <script type="text/javascript">
        function profileCheckEnter(event)
        {
            if(event.keyCode == 13)
            {
                profileSubmit();
                return false;
            }
            else
            {
                return true;
            }
        }

        function profileSubmit()
        {
            var newUrl = "tf2items.html?profile=";

            var profileName = document.getElementById("id_profile_submit_text_profile").value;
            newUrl = newUrl + profileName;

            var sortType = document.getElementById("id_profile_submit_select_sort").value;
            newUrl = newUrl + "&sort=" + sortType;

            if (document.getElementById("id_profile_submit_checkbox_images").checked == true)
                newUrl = newUrl + "&images=1";
            else
                newUrl = newUrl + "&images=0";

            window.location.replace(newUrl);
        }
    </script>

    <title>tf2items</title>
</head>

<body>
    <h1>tf2items</h1>

    <div id="id_profile_submit">
        <table>
            <tr>
                <td><b>Profile:</b></td>
                <td>
                    <input type="text" id="id_profile_submit_text_profile" onKeyPress="profileCheckEnter(event)" />
                </td>
                <td>
                    <input type="button" id="id_profile_submit_button_ok" value="OK" onclick="profileSubmit()" />
                </td>
            </tr>
            <tr>
                <td><b>Sort by:</b></td>
                <td>
                    <select id="id_profile_submit_select_sort">
                        <option value="default" selected="selected">default</option>
                        <option value="id">id</option>
                        <option value="name">name</option>
                        <option value="type">type</option>
                        <option value="quality">quality</option>
                        <option value="slot">slot</option>
                        <option value="class">class</option>
                        <option value="level">level</option>
                        <option value="inventory">inventory</option>
                    </select>
                </td>
                <td></td>
            </tr>
            <tr>
                <td><b>Images:</b></td>
                <td>
                    <input type="checkbox" id="id_profile_submit_checkbox_images" checked />
                </td>
                <td></td>
            </tr>
        </table>
    </div>

    <p />

    <div id="id_profile"></div>

    <p />

    <div id="id_profile_summary"></div>
        <table>
            <tr>
                <td><b>Name:</b></td>
                <td id="id_profile_summary_name"></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><b>Date:</b></td>
                <td id="id_profile_summary_date"></td>
            </tr>
            <tr>
                <td><b>Time:</b></td>
                <td id="id_profile_summary_time"></td>
            </tr>
        </table>
    <p />

    <div id="id_items"></div>

    <p />

    <div id="id_items_summary">
        <table>
            <tr>
                <td><b>Items:</b></td>
                <td id="id_items_summary_n_items">0</td>
            </tr>
            <tr>
                <td><b>Hats:</b></td>
                <td id="id_items_summary_n_hats">0</td>
            </tr>
            <tr>
                <td><b>Metals:</b></td>
                <td id="id_items_summary_n_metals">0</td>
            </tr>
            <tr>
                <td><b>Tokens:</b></td>
                <td id="id_items_summary_n_tokens">0</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><b>Total:</b></td>
                <td id="id_items_summary_n_total">0</td>
            </tr>
        </table>
    </div>

    <p />

    <div id="id_items_found"></div>

    <p />

    <div id="id_items_found_summary">
        <table>
            <tr>
                <td><b>Items Found:</b></td>
                <td id="id_items_found_summary_n_items_found">0</td>
            </tr>
            <tr>
                <td><b>Hats Found:</b></td>
                <td id="id_items_found_summary_n_hats_found">0</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><b>Total Found:</b></td>
                <td id="id_items_found_summary_n_total_found">0</td>
            </tr>
        </table>
    </div>

    <p />

    <div id="id_items_null"></div>

    <p />

    <script type="text/javascript">
        function profileRender()
        {
            var queryString = new Querystring();

            var queryProfile = queryString.get("profile", "null");

            if (queryProfile == "null" || queryProfile == "")
                return false;

            document.getElementById("id_profile_submit_text_profile").value = queryProfile;

            var queryImages = queryString.get("images", "1");

            if (queryImages == "1")
                document.getElementById("id_profile_submit_checkbox_images").checked = true;
            else
                document.getElementById("id_profile_submit_checkbox_images").checked = false;

            var querySort = queryString.get("sort", "");

            document.getElementById("id_profile_submit_select_sort").value = querySort;

            $("#id_profile_summary").append("<hr>");
            $("#id_profile_summary").append("<h2>Profile</h2>");

            $("#id_items").append("<hr>");
            $("#id_items").append("<h2>Backpack</h2>");

            $("#id_items_found").append("<hr>");
            $("#id_items_found").append("<h2>Items Found</h2>");

            $("#id_profile_summary_name").text(queryProfile);

            var profilePath = "profiles/" + queryProfile + ".json";

            $.getJSON
            (
                profilePath,
                function(root)
                {
                    $("#id_profile_summary_date").text(root.date);
                    $("#id_profile_summary_time").text(root.time);

                    $("#id_items_summary_n_items").text(root.n_items);
                    $("#id_items_summary_n_hats").text(root.n_hats);
                    $("#id_items_summary_n_metals").text(root.n_metals);
                    $("#id_items_summary_n_tokens").text(root.n_tokens);
                    $("#id_items_summary_n_total").text((root.n_items + root.n_hats + root.n_metals + root.n_tokens) + " / 100");

                    $("#id_items_found_summary_n_items_found").text(root.n_items_found);
                    $("#id_items_found_summary_n_hats_found").text(root.n_hats_found);
                    $("#id_items_found_summary_n_total_found").text((root.n_items_found + root.n_hats_found));

                    function sortById(a, b)
                    {
                        return b.id - a.id;
                    }

                    function sortByName(a, b)
                    {
                        return ((a.name == b.name) ? 0 :
                               ((a.name >  b.name) ? 1 : -1));
                    }

                    function sortByType(a, b)
                    {
                        return ((a.type == b.type) ? 0 :
                               ((a.type >  b.type) ? 1 : -1));
                    }

                    function sortByQuality(a, b)
                    {
                        return ((a.quality == b.quality) ? 0 :
                               ((a.quality >  b.quality) ? 1 : -1));
                    }

                    function sortBySlot(a, b)
                    {
                        return ((a.slot == b.slot) ? 0 :
                               ((a.slot >  b.slot) ? 1 : -1));
                    }

                    function sortByClass(a, b)
                    {
                        return ((a.class == b.class) ? 0 :
                               ((a.class >  b.class) ? 1 : -1));
                    }

                    function sortByLevel(a, b)
                    {
                        return b.level - a.level;
                    }

                    function sortByInventory(a, b)
                    {
                        return b.inventory - a.inventory;
                    }

                    if (querySort == "id")
                    {
                        root.items.sort(sortById);
                    }
                    else if (querySort == "name")
                    {
                        root.items.sort(sortByName);
                    }
                    else if (querySort == "type")
                    {
                        root.items.sort(sortByType);
                    }
                    else if (querySort == "quality")
                    {
                        root.items.sort(sortByQuality);
                    }
                    else if (querySort == "slot")
                    {
                        root.items.sort(sortBySlot);
                    }
                    else if (querySort == "class")
                    {
                        root.items.sort(sortByClass);
                    }
                    else if (querySort == "level")
                    {
                        root.items.sort(sortByLevel);
                    }
                    else if (querySort == "inventory")
                    {
                        root.items.sort(sortByInventory);
                    }

                    $.each
                    (
                        root.items,
                        function(index, item)
                        {
                            var inventoryId = "#id_items_null";

                            if (item.inventory == 0)
                            {
                                inventoryId = "#id_items_found";
                            }
                            else
                            {
                                inventoryId = "#id_items";
                            }

                            /*
                                if (index > 0 && index % 10 == 0)
                                {
                                    $(inventoryId).append("<br />");
                                }
                            */

                            if (queryImages == "1")
                            {
                                var imagePath = "images/" + item.image + ".png";

                                var imageClass = "class_null";
                                if (inventoryId == "#id_items")
                                {
                                    imageClass = "class_items";
                                }
                                else if (inventoryId == "#id_items_found")
                                    imageClass = "class_items_found";

                                $("<img />").attr("src", imagePath).attr("class", imageClass).attr("title", item.name).attr("alt", item.name).appendTo(inventoryId);
                            }
                            else
                            {
                                $(inventoryId).append(item.name + "<br />");
                            }
                        }
                    );
                }
            );
        }

        profileRender();
    </script>

</body>

</html>
